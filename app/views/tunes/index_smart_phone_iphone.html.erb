<div data-role="page" id="todo_nav" data-theme="a">
  <div data-role="header" data-position="fixed">
    <a href="#option" data-icon="gear" class="ui-btn-left">Option</a>
    <h3>楽曲リスト</h3>
    <%= link_to 'Logout', [ :destroy, :user_session ], :class => 'ui-btn-right', 'rel' => 'external' %>
  </div>

  <div data-role="content">
    <ul data-role="listview">
    <% @tunes.each do |t| %>
      <li id="id_<%= t.id %>" class="<%= t.recordings.inject(""){|album_classes, r| album_classes << "album_#{r.album.id} "} %>" >
        <a href="#tune_<%= t.id %>" data-transition="slidefade">
          <%= image_tag ("albums/#{t.recordings[0].album.title}.jpg") %>
          <h3 class="tune-title"><%= t.title %></h3>
          <p>
            <span class="tuning-name"><%= t.tuning.name %></span>
          </p>
          <p>
            <span id="progress_<%= t.id %>" class="progress-bar"><%= t.progress_val(@user) %></span>
          </p>
        </a>
      </li>
    <% end %>
    </ul>
  </div>
  <%= render "footer_smart_phone_iphone" , { :state => "tunelist" } %>
</div>

<script>
$(".progress-bar").each(function(elem){
  $(this).progressBar(progress_default_option);
});
</script>

<% @tunes.each do |t| %>
<div data-role="page" id="tune_<%= t.id %>" data-theme="a">
  <div data-role="header" data-position="fixed">
    <h1>曲詳細</h1>
  </div>

  <div data-role="content" data-theme="a">
    <h2><%= t.title %></h2>
    <div class="album-title">
      <p>
        <%= raw t.recordings.inject([]){|albums,r| albums << r.album.title}.join("<br>") %>
      </p>
    </div> 

    <p><span class="tuning"><%= t.tuning.name =%></span>
    <% if t.tuning.capo != nil and t.tuning.capo != 0 %>
      <span class="tuning">(Capo : <%= t.tuning.capo =%>)</span>
    <% end %>
    </p>

    <p><span id="tune_progress_<%= t.id %>" class="progress-bar"><%= t.progress_val(@user) %></span>
    </p>

    <div id="progress_updated_at_<%= t.id %>">
      <%= last_played_at(t.progress_updated_at(@user)) %>
    </div>

    <% if current_user == @user %>
    <div class="ui-grid-b">
      <div class="ui-block-a">
        <button onclick="progress_controller.down('<%= @user.id %>','<%= t.id %>')"><font style="font-size: 14pt;"><%= "<<" %></font></button>
      </div>
      <div class="ui-block-b">
        <button onclick="progress_controller.play('<%= @user.id %>','<%= t.id %>')"><i class="icon-music icon-white"></i>+1</font></button>
      </div>
      <div class="ui-block-c">
        <button onclick="progress_controller.up('<%= @user.id %>','<%= t.id %>')"><font style="font-size: 14pt;"><%= ">>" %></font></button>
      </div>
    </div>
    <% end %>
    <a data-rel="back" data-icon="back" data-role="button">戻る</a>
  </div>

  <%= render "footer_smart_phone_iphone" , { :state => "tune" } %>
</div>

<script>
$('#tune_<%= t.id %>').live( 'pageinit',function(event){
  $('#tune_<%= t.id %> .progress-bar').progressBar(progress_default_option);
});
</script>

<% end %>
